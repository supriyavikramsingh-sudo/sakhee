# ğŸ”„ RAG RETRIEVAL FLOW - VISUAL DIAGRAM

## Current System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER REQUEST                                  â”‚
â”‚  Cuisines: [Naga, Tripuri, Arunachali]                          â”‚
â”‚  Diet: Jain + Keto                                               â”‚
â”‚  Restrictions: Gluten, Eggs                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STAGE 1: MEAL TEMPLATE RETRIEVAL                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Query Builder:                                                  â”‚
â”‚  â”œâ”€ "Naga breakfast meals dishes regional jain"                 â”‚
â”‚  â”œâ”€ "Naga lunch traditional recipes authentic jain"             â”‚
â”‚  â”œâ”€ "Naga dinner evening meal main course jain"                 â”‚
â”‚  â”œâ”€ "Naga snacks traditional dishes jain"                       â”‚
â”‚  â””â”€ "Naga cuisine traditional regional specialties"             â”‚
â”‚                                                                  â”‚
â”‚  Ã— 3 cuisines = 15 queries total                                â”‚
â”‚                                                                  â”‚
â”‚  Pinecone Retrieval:                                             â”‚
â”‚  â”œâ”€ Vector search: topK=25 per query                            â”‚
â”‚  â”œâ”€ Raw results: 375 documents                                  â”‚
â”‚  â””â”€ Semantic matching based on embeddings                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FILTERING PIPELINE:                                             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 1. CUISINE FILTER                    â”‚                       â”‚
â”‚  â”‚ âœ“ Check metadata.state               â”‚                       â”‚
â”‚  â”‚ âœ“ Check metadata.regionalSection     â”‚                       â”‚
â”‚  â”‚ âœ“ Check content for "State: Naga"    â”‚                       â”‚
â”‚  â”‚ âœ— WEAKNESS: Also matches substitutes â”‚                       â”‚
â”‚  â”‚   with "Naga-style" mentions         â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 2. ALLERGEN FILTER                   â”‚                       â”‚
â”‚  â”‚ âœ“ Check meal name for allergens      â”‚                       â”‚
â”‚  â”‚ âœ“ Check ingredients section          â”‚                       â”‚
â”‚  â”‚ âœ“ Check full content                 â”‚                       â”‚
â”‚  â”‚ âŒ BUG: 8 meals with allergens passed â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 3. KETO FILTER (Skip - Adapt Later)  â”‚                       â”‚
â”‚  â”‚ â„¹ï¸ High-carb meals NOT rejected      â”‚                       â”‚
â”‚  â”‚ â„¹ï¸ Will be adapted by LLM            â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 4. DIET TYPE FILTER (Jain)           â”‚                       â”‚
â”‚  â”‚ âœ“ Accept vegetarian + non-veg        â”‚                       â”‚
â”‚  â”‚ âœ“ LLM will adapt non-veg to paneer   â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Results: 88 filtered templates                                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 5. HYBRID RE-RANKING                 â”‚                       â”‚
â”‚  â”‚ âœ“ Semantic: 25%                      â”‚                       â”‚
â”‚  â”‚ âœ“ Protein: 20%                       â”‚                       â”‚
â”‚  â”‚ âœ“ Carbs: 25% (boosted for keto)     â”‚                       â”‚
â”‚  â”‚ âœ“ GI: 15%                            â”‚                       â”‚
â”‚  â”‚ âœ“ Budget: 10%                        â”‚                       â”‚
â”‚  â”‚ âœ“ Time: 5%                           â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 6. DEDUPLICATION                     â”‚                       â”‚
â”‚  â”‚ âœ“ Remove duplicate meals             â”‚                       â”‚
â”‚  â”‚ âœ“ Prefer state-specific labels       â”‚                       â”‚
â”‚  â”‚ 88 â†’ 88 (no duplicates found)        â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 7. TOKEN LIMIT PROTECTION            â”‚                       â”‚
â”‚  â”‚ âš ï¸ Limit to top 40 re-ranked meals   â”‚                       â”‚
â”‚  â”‚ 88 â†’ 40 final templates              â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STAGE 2: SYMPTOM GUIDANCE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Symptoms: [weight-gain, hair-loss, mood-swings]                â”‚
â”‚                                                                  â”‚
â”‚  Parallel Queries:                                               â”‚
â”‚  â”œâ”€ "weight-gain PCOS dietary recommendations"                  â”‚
â”‚  â”œâ”€ "hair-loss PCOS dietary recommendations"                    â”‚
â”‚  â””â”€ "mood-swings PCOS dietary recommendations"                  â”‚
â”‚                                                                  â”‚
â”‚  Retrieved: 6 docs (2 per symptom)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STAGE 3: LAB MARKER GUIDANCE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Abnormal markers: [ferritin=7.7 (low)]                         â”‚
â”‚                                                                  â”‚
â”‚  Query: "ferritin PCOS dietary guidance nutrition"              â”‚
â”‚                                                                  â”‚
â”‚  Retrieved: 2 docs                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         STAGE 4: PCOS INGREDIENT SUBSTITUTES                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Jain diet â†’ Need protein substitutes                           â”‚
â”‚                                                                  â”‚
â”‚  Queries:                                                        â”‚
â”‚  â”œâ”€ "fish chicken egg meat protein substitute jain"             â”‚
â”‚  â”œâ”€ "potato onion garlic substitute jain hing cauliflower"      â”‚
â”‚  â”œâ”€ "sugar PCOS substitute jain Northeast India"                â”‚
â”‚  â””â”€ "cream PCOS substitute jain Northeast India"                â”‚
â”‚                                                                  â”‚
â”‚  Retrieved: 10 docs                                              â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”´ PROBLEM: These docs contain meal examples!                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Doc content:                                 â”‚               â”‚
â”‚  â”‚ "Replace sugary upma with cauliflower upma"  â”‚               â”‚
â”‚  â”‚ "Try coconut flour dosa for South Indian"    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STAGE 5: KETO SUBSTITUTES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  isKeto=true â†’ Retrieve keto adaptations                        â”‚
â”‚                                                                  â”‚
â”‚  Queries:                                                        â”‚
â”‚  â”œâ”€ "keto substitutes cauliflower rice almond flour"            â”‚
â”‚  â”œâ”€ "jain keto paneer tofu cauliflower low carb"                â”‚
â”‚  â””â”€ "sugar substitute stevia erythritol keto Indian"            â”‚
â”‚                                                                  â”‚
â”‚  Retrieved: 17 docs                                              â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”´ğŸ”´ CRITICAL PROBLEM: Extensive meal examples!                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Doc content:                                 â”‚               â”‚
â”‚  â”‚ "KETO GRAIN REPLACEMENTS:                    â”‚               â”‚
â”‚  â”‚  - Rice â†’ Cauliflower rice                   â”‚               â”‚
â”‚  â”‚    Example dishes:                           â”‚               â”‚
â”‚  â”‚    â€¢ Cauliflower Upma with Vegetables        â”‚               â”‚
â”‚  â”‚    â€¢ Coconut Flour Dosa with Spinach         â”‚               â”‚
â”‚  â”‚    â€¢ Cauliflower Biryani                     â”‚               â”‚
â”‚  â”‚                                               â”‚               â”‚
â”‚  â”‚  - Upma variations:                          â”‚               â”‚
â”‚  â”‚    â€¢ Traditional upma (FORBIDDEN)            â”‚               â”‚
â”‚  â”‚    â€¢ Keto upma: Use cauliflower              â”‚               â”‚
â”‚  â”‚    â€¢ South Indian style: curry leaves"       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STAGE 6: ALLERGY SUBSTITUTES                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Restrictions: [gluten, eggs]                                    â”‚
â”‚                                                                  â”‚
â”‚  Gluten queries (3 queries Ã— topK=5):                           â”‚
â”‚  â”œâ”€ "gluten substitute alternatives recipes Indian"             â”‚
â”‚  â”œâ”€ "gluten-free flour roti bread alternatives"                 â”‚
â”‚  â””â”€ "wheat replacement gluten allergy Indian cuisine"           â”‚
â”‚                                                                  â”‚
â”‚  Egg queries (3 queries Ã— topK=4-5):                            â”‚
â”‚  â”œâ”€ "eggs substitute alternatives baking binding"               â”‚
â”‚  â”œâ”€ "egg-free protein breakfast Indian"                         â”‚
â”‚  â””â”€ "egg replacement flax chia vegan Indian"                    â”‚
â”‚                                                                  â”‚
â”‚  Retrieved: 42 docs                                              â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”´ PROBLEM: More meal examples!                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ "Gluten-free alternatives:                   â”‚               â”‚
â”‚  â”‚  - Replace wheat dosa with ragi dosa         â”‚               â”‚
â”‚  â”‚  - Try coconut flour dosa for South Indian"  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CONTEXT BUILDING & COMPRESSION                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Meal Templates (40 docs)                     â”‚               â”‚
â”‚  â”‚ âœ“ Compressed to ~260 chars each              â”‚               â”‚
â”‚  â”‚ âœ“ Saved ~10,400 tokens                       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Ingredient Substitutes (10+17+42 = 69 docs)  â”‚               â”‚
â”‚  â”‚ âœ“ Truncated to 800 chars each                â”‚               â”‚
â”‚  â”‚ âœ“ Saved ~11,197 tokens                       â”‚               â”‚
â”‚  â”‚ âŒ Still contains meal example text          â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â”‚  Total prompt size: 88,923 characters (~22,000 tokens)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PROMPT CONSTRUCTION                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Section 1: User Context                                        â”‚
â”‚  â”œâ”€ Demographics, health goals, symptoms                        â”‚
â”‚  â””â”€ ~1,500 chars                                                â”‚
â”‚                                                                  â”‚
â”‚  Section 2: Keto Instructions (isKeto=true)                     â”‚
â”‚  â”œâ”€ ğŸš¨ CRITICAL MEAL TEMPLATE RULE                             â”‚
â”‚  â”‚  "âœ… USE ONLY meal templates from section above"            â”‚
â”‚  â”‚  "âŒ FORBIDDEN: Ragi Dosa, Moong Dal Chilla"                â”‚
â”‚  â”œâ”€ Keto macro targets (70% fat, 25% protein, 5% carbs)        â”‚
â”‚  â”œâ”€ Food eliminations (NO grains, NO dals, NO starchy veg)     â”‚
â”‚  â”œâ”€ Keto replacements (riceâ†’cauliflower, rotiâ†’almond flour)    â”‚
â”‚  â”œâ”€ Jain keto adaptations                                       â”‚
â”‚  â””â”€ ~8,000 chars                                                â”‚
â”‚                                                                  â”‚
â”‚  Section 3: Regional Authenticity                               â”‚
â”‚  â”œâ”€ âœ… ONLY dishes from: Naga, Tripuri, Arunachali             â”‚
â”‚  â”œâ”€ âŒ FORBIDDEN: idli, dosa, upma, vada, pongal               â”‚
â”‚  â””â”€ ~2,000 chars                                                â”‚
â”‚                                                                  â”‚
â”‚  Section 4: RAG Context (ğŸ“‹ MEAL TEMPLATES)                    â”‚
â”‚  â”œâ”€ 40 compressed meal templates                                â”‚
â”‚  â”œâ”€ Each with: name, ingredients, macros, cost, region          â”‚
â”‚  â””â”€ ~10,400 chars                                               â”‚
â”‚                                                                  â”‚
â”‚  Section 5: RAG Context (ğŸ“š INGREDIENT SUBSTITUTION GUIDE)     â”‚
â”‚  â”œâ”€ PCOS substitutes (10 docs)                                  â”‚
â”‚  â”œâ”€ Keto substitutes (17 docs) â† Contains "Cauliflower Upma"   â”‚
â”‚  â”œâ”€ Allergy substitutes (42 docs) â† Contains "Coconut Dosa"    â”‚
â”‚  â”œâ”€ Truncated to 800 chars each                                 â”‚
â”‚  â””â”€ ~55,200 chars                                               â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”‚ âš ï¸ LLM SEES:                                                 â”‚
â”‚  â”‚ "Keto Grain Replacements:                                    â”‚
â”‚  â”‚  - Upma â†’ Cauliflower upma                                   â”‚
â”‚  â”‚  - Dosa â†’ Coconut flour dosa"                                â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”‚ âš ï¸ LLM INTERPRETS:                                           â”‚
â”‚  â”‚ "Cauliflower upma is a valid keto adaptation!"               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â”‚  Section 6: Symptom & Lab Guidance                              â”‚
â”‚  â”œâ”€ Symptom recommendations (6 docs)                            â”‚
â”‚  â”œâ”€ Lab marker guidance (2 docs)                                â”‚
â”‚  â””â”€ ~3,000 chars                                                â”‚
â”‚                                                                  â”‚
â”‚  Section 7: Nutrition Guidelines                                â”‚
â”‚  â”œâ”€ PCOS general guidelines (5 docs)                            â”‚
â”‚  â””â”€ ~2,000 chars                                                â”‚
â”‚                                                                  â”‚
â”‚  Section 8: Output Format & Validation                          â”‚
â”‚  â”œâ”€ JSON schema                                                 â”‚
â”‚  â”œâ”€ Macro calculation examples                                  â”‚
â”‚  â””â”€ ~6,823 chars                                                â”‚
â”‚                                                                  â”‚
â”‚  TOTAL: 88,923 characters                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LLM PROCESSING (GPT-4o-mini)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LLM's Interpretation:                                           â”‚
â”‚                                                                  â”‚
â”‚  Step 1: Read "CRITICAL MEAL TEMPLATE RULE"                     â”‚
â”‚  âœ“ "Use only meal templates from section above"                 â”‚
â”‚  âœ“ "Don't create from scratch"                                  â”‚
â”‚  âœ“ "Forbidden: Ragi Dosa, Moong Dal Chilla"                     â”‚
â”‚                                                                  â”‚
â”‚  Step 2: Read "INGREDIENT SUBSTITUTION GUIDE"                   â”‚
â”‚  âŒ Sees: "Upma â†’ Cauliflower upma"                             â”‚
â”‚  âŒ Interprets: "Cauliflower upma is a valid keto adaptation"   â”‚
â”‚  âŒ Logic: "Upma is forbidden, but Cauliflower upma is adapted" â”‚
â”‚                                                                  â”‚
â”‚  Step 3: Generate meal plan                                     â”‚
â”‚  For Day 2 Breakfast:                                            â”‚
â”‚  â”œâ”€ Thinks: "Need a Tripuri keto jain breakfast"                â”‚
â”‚  â”œâ”€ Recalls: "Cauliflower upma" from substitution guide         â”‚
â”‚  â”œâ”€ Generates: "Vegetable Cauliflower Upma (Tripuri Keto Jain)" â”‚
â”‚  â””â”€ Believes: "I followed the ADAPT rules correctly!"           â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”´ CONTRADICTION: Instruction says "don't use generic upma"    â”‚
â”‚                    but substitution guide shows "cauliflower upma"â”‚
â”‚                                                                  â”‚
â”‚  Processing time: 63,525ms (64 seconds)                         â”‚
â”‚  Output: 8,006 characters JSON                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 POST-GENERATION VALIDATION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Cuisine Validation                           â”‚               â”‚
â”‚  â”‚                                               â”‚               â”‚
â”‚  â”‚ Check each meal:                             â”‚               â”‚
â”‚  â”‚ â”œâ”€ "Vegetable Cauliflower Upma (Tripuri)"    â”‚               â”‚
â”‚  â”‚ â”‚  âŒ Contains "upma" keyword                 â”‚               â”‚
â”‚  â”‚ â”‚  âŒ "upma" is in south-indian forbidden listâ”‚               â”‚
â”‚  â”‚ â”‚  ğŸš¨ VIOLATION DETECTED                      â”‚               â”‚
â”‚  â”‚                                               â”‚               â”‚
â”‚  â”‚ Result: 1 cuisine violation found            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Allergen Validation (Fallback)               â”‚               â”‚
â”‚  â”‚                                               â”‚               â”‚
â”‚  â”‚ Stage 1 failed to filter allergens           â”‚               â”‚
â”‚  â”‚ â”œâ”€ 8 meals with gluten/eggs passed through   â”‚               â”‚
â”‚  â”‚ â””â”€ Fallback removed them here                â”‚               â”‚
â”‚  â”‚                                               â”‚               â”‚
â”‚  â”‚ Result: 8 allergen violations (fixed)        â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â”‚  [ERROR] CUISINE VALIDATION FAILED                              â”‚
â”‚  [ERROR] ALLERGEN VALIDATION FAILED IN STAGE 1                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FINAL OUTPUT                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Generated: 9 meals (3 days Ã— 3 meals)                          â”‚
â”‚  âœ… Correct cuisine: 5 meals (55.6%)                            â”‚
â”‚  âŒ Wrong cuisine: 1 meal (11.1%)                               â”‚
â”‚  âš ï¸ Missing labels: 3 meals (33.3%)                             â”‚
â”‚                                                                  â”‚
â”‚  Performance:                                                    â”‚
â”‚  â”œâ”€ RAG time: 38,842ms (38%)                                    â”‚
â”‚  â”œâ”€ LLM time: 63,525ms (62%)                                    â”‚
â”‚  â””â”€ Total: 103,122ms                                            â”‚
â”‚                                                                  â”‚
â”‚  Cost: ~$0.012 (22K prompt + 2K response tokens)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Problem Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THE CONTAMINATION PATH                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. SUBSTITUTE DOC IN PINECONE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Document: keto_grain_substitutes.txt         â”‚
   â”‚ Type: medical_knowledge                      â”‚
   â”‚                                               â”‚
   â”‚ Content:                                     â”‚
   â”‚ "Keto Grain Replacements for Indian Cuisine: â”‚
   â”‚                                               â”‚
   â”‚  Rice â†’ Cauliflower rice                     â”‚
   â”‚  â€¢ Use in: Biryani, Pulao, Fried rice        â”‚
   â”‚                                               â”‚
   â”‚  Semolina/Upma â†’ Cauliflower upma            â”‚
   â”‚  â€¢ Traditional upma uses semolina (HIGH CARB)â”‚
   â”‚  â€¢ Keto version: pulse cauliflower           â”‚
   â”‚  â€¢ Example: Cauliflower Upma with Vegetables â”‚
   â”‚  â€¢ South Indian style: curry leaves, mustard"â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
2. RETRIEVED IN STAGE 5 (Keto Substitutes)
   Query: "keto substitutes cauliflower rice almond flour"
   âœ“ Matches: Contains "keto", "substitutes", "cauliflower rice"
   âœ“ Retrieved with score 0.85
                       â”‚
                       â–¼
3. ADDED TO PROMPT AS "INGREDIENT SUBSTITUTION GUIDE"
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ“š INGREDIENT SUBSTITUTION GUIDE:            â”‚
   â”‚                                               â”‚
   â”‚ Keto Grain Replacements:                     â”‚
   â”‚  - Rice â†’ Cauliflower rice                   â”‚
   â”‚  - Semolina/Upma â†’ Cauliflower upma          â”‚
   â”‚    Example: Cauliflower Upma with Vegetables â”‚
   â”‚    South Indian style: curry leaves          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
4. LLM READS AND INTERPRETS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ LLM's thought process:                       â”‚
   â”‚                                               â”‚
   â”‚ "I need a Tripuri breakfast..."              â”‚
   â”‚ "I see 'upma' is forbidden (South Indian)"   â”‚
   â”‚ "But 'Cauliflower upma' is in substitutes"   â”‚
   â”‚ "This must be the KETO ADAPTATION of upma"   â”‚
   â”‚ "I'll use it: Vegetable Cauliflower Upma"    â”‚
   â”‚ "Add Tripuri label for authenticity"         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
5. GENERATES WRONG MEAL
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Output:                                      â”‚
   â”‚ "Day 2 breakfast:                            â”‚
   â”‚  Vegetable Cauliflower Upma (Tripuri Keto    â”‚
   â”‚  Jain)"                                      â”‚
   â”‚                                               â”‚
   â”‚ âŒ "upma" detected in meal name              â”‚
   â”‚ âŒ Violates South Indian cuisine restriction â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
6. VALIDATION CATCHES IT (TOO LATE)
   [ERROR] CUISINE VALIDATION FAILED
   Contains south-indian dish (forbidden)
```

---

## Solution Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROPOSED SOLUTION                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. CLEAN SUBSTITUTE DOCS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Document: keto_grain_substitutes.txt         â”‚
   â”‚ Type: medical_knowledge                      â”‚
   â”‚                                               â”‚
   â”‚ Content (CLEANED):                           â”‚
   â”‚ "Keto Grain Replacements for Indian Cuisine: â”‚
   â”‚                                               â”‚
   â”‚  Rice â†’ Cauliflower rice                     â”‚
   â”‚  â€¢ Preparation: pulse raw cauliflower        â”‚
   â”‚  â€¢ Cooking: same spices as rice dishes       â”‚
   â”‚                                               â”‚
   â”‚  Semolina â†’ Cauliflower (pulsed)             â”‚
   â”‚  â€¢ Preparation: finely processed cauliflower â”‚
   â”‚  â€¢ Cooking: sautÃ© with ghee and spices       â”‚
   â”‚  â€¢ Usage: replace in any semolina recipe"    â”‚
   â”‚                                               â”‚
   â”‚  âŒ REMOVED: "Cauliflower Upma"              â”‚
   â”‚  âŒ REMOVED: "South Indian style"            â”‚
   â”‚  âŒ REMOVED: All meal name examples          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
2. ADD EXPLICIT DISCLAIMER IN PROMPT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ“š INGREDIENT SUBSTITUTION GUIDE:            â”‚
   â”‚                                               â”‚
   â”‚ âš ï¸ CRITICAL INSTRUCTIONS:                    â”‚
   â”‚ â€¢ These are INGREDIENT SUBSTITUTES ONLY      â”‚
   â”‚ â€¢ NOT complete meal templates                â”‚
   â”‚ â€¢ DO NOT use dish names from this section    â”‚
   â”‚ â€¢ ALWAYS select from MEAL TEMPLATES above    â”‚
   â”‚                                               â”‚
   â”‚ Keto Grain Replacements:                     â”‚
   â”‚  - Rice â†’ Cauliflower rice (pulsed)          â”‚
   â”‚  - Semolina â†’ Cauliflower (finely processed) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
3. PRE-VALIDATION OF MEAL TEMPLATES
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Before sending to LLM:                       â”‚
   â”‚                                               â”‚
   â”‚ For each template in final 40:              â”‚
   â”‚ â”œâ”€ Check meal name against requested cuisinesâ”‚
   â”‚ â”œâ”€ Check for forbidden cuisine keywords      â”‚
   â”‚ â””â”€ Remove if doesn't match                   â”‚
   â”‚                                               â”‚
   â”‚ Example:                                     â”‚
   â”‚ âŒ "Masala Dosa" â†’ Contains "dosa" (forbidden)â”‚
   â”‚    â†’ Removed before LLM sees it              â”‚
   â”‚                                               â”‚
   â”‚ Result: Only valid Naga/Tripuri/Arunachali   â”‚
   â”‚         templates sent to LLM                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
4. LLM GENERATES CORRECT MEALS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ LLM's thought process:                       â”‚
   â”‚                                               â”‚
   â”‚ "I need a Tripuri breakfast..."              â”‚
   â”‚ "Checking meal templates..."                 â”‚
   â”‚ "Found: Black Rice Porridge (Tripura)"       â”‚
   â”‚ "This is Tripuri, matches requirements"      â”‚
   â”‚ "Adapting for keto: coconut cream instead"   â”‚
   â”‚ "No upma/dosa examples in substitutes"       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
5. OUTPUT: CORRECT CUISINE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ "Day 2 breakfast:                            â”‚
   â”‚  Black Rice Porridge with Coconut Cream      â”‚
   â”‚  (Tripura Keto Jain)"                        â”‚
   â”‚                                               â”‚
   â”‚ âœ… Tripuri cuisine âœ“                         â”‚
   â”‚ âœ… No forbidden keywords âœ“                   â”‚
   â”‚ âœ… Keto adapted âœ“                            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
6. VALIDATION PASSES
   [INFO] CUISINE VALIDATION PASSED
   All meals match requested cuisines
```

---

## Metrics Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BEFORE vs AFTER                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CURRENT SYSTEM (BEFORE FIX)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cuisine Accuracy:      55.6%       â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”‚ Wrong Cuisine:         11.1%       â”‚ â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”‚ Missing Labels:        33.3%       â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”‚ Prompt Size:           88,923 charsâ”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ Generation Time:       103 seconds â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘
â”‚ Cost per plan:         $0.012      â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER PRIORITY 1 FIXES (IMMEDIATE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cuisine Accuracy:      90.0%       â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘
â”‚ Wrong Cuisine:         1.1%        â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”‚ Missing Labels:        8.9%        â”‚ â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”‚ Prompt Size:           75,000 charsâ”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘
â”‚ Generation Time:       95 seconds  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘
â”‚ Cost per plan:         $0.010      â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Improvement: +61% accuracy, -15% cost, -8% time

AFTER ALL OPTIMIZATIONS (1 MONTH)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cuisine Accuracy:      98.0%       â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ Wrong Cuisine:         0.0%        â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”‚ Missing Labels:        2.0%        â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”‚ Prompt Size:           65,000 charsâ”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘
â”‚ Generation Time:       80 seconds  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘
â”‚ Cost per plan:         $0.008      â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Improvement: +76% accuracy, -33% cost, -22% time
```

---

## Implementation Timeline

```
WEEK 1: Critical Fixes (Priority 1)
â”‚
â”œâ”€ Day 1-2: Remove meal examples from substitute content
â”‚  â””â”€ Impact: 60% accuracy improvement
â”‚
â”œâ”€ Day 3: Add disclaimers to substitute sections  
â”‚  â””â”€ Impact: 15% accuracy improvement
â”‚
â”œâ”€ Day 4-5: Implement pre-generation validation
â”‚  â””â”€ Impact: 10% accuracy improvement
â”‚
â””â”€ Day 6-7: Test with 10 multi-cuisine scenarios
   â””â”€ Target: 90% accuracy achieved

WEEK 2: Content Cleanup (Priority 2)
â”‚
â”œâ”€ Day 1-3: Audit 116 substitute documents
â”‚  â””â”€ Remove meal examples, add pure ingredient info
â”‚
â”œâ”€ Day 4-5: Re-upload to Pinecone
â”‚  â””â”€ Test retrieval quality
â”‚
â””â”€ Day 6-7: A/B test old vs new retrieval
   â””â”€ Target: 95% accuracy achieved

WEEK 3-4: Advanced Optimizations (Priority 3)
â”‚
â”œâ”€ Week 3: Add cuisine tags to meal templates
â”‚  â””â”€ Target: 98% accuracy
â”‚
â””â”€ Week 4: Implement two-phase retrieval + LLM validation
   â””â”€ Target: 99% accuracy, -15% token usage
```
